@inject IDialogService DialogService
@page "/FinalSettlement"
@using Refuntations_App.Pages.Components;

<PageTitle>Konačni obračun</PageTitle>

<MudContainer Class="mt-5" MaxWidth="MaxWidth.ExtraLarge">
    <MudGrid Class="d-flex justify-center mt-10">
        <MudItem hidden="@(finalSettlements!=null?true:false)" xs="12" md="4" lg="5">
            <DisplayFinalSettlement @bind-finalSettlements="finalSettlements" />
        </MudItem>
    </MudGrid>
    <MudGrid Class="d-flex justify-center">
        <MudItem xs="12" md="8" lg="@(Hide==true?12:10)">
            <MudTable Items="@finalSettlements" Dense="true" Hover="true">
                <ToolBarContent>
                    <MudText Typo="Typo.h6">Konacni obracun</MudText>
                    <MudSpacer />
                    <MudItem Class="justify-center" xs="7">
                        @*<MudTextField @bind-Value="TextValue" Placeholder="Search" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0" />*@
                    </MudItem>
                    <MudSpacer />
                    <MudButton OnClick="@(async ()=>await ShowFilter())" Class="align-self-center" Variant="Variant.Filled" Color="Color.Warning" Size="Size.Small" StartIcon="@Icons.Filled.FilterAlt">Filter</MudButton>
                    <MudButton OnClick="@(async ()=>await ShowDialog())" Class="align-self-center ml-3" Variant="Variant.Filled" Color="Color.Info" Size="Size.Small" StartIcon="@Icons.Filled.ReadMore">Prikaz</MudButton>
                </ToolBarContent>
                <HeaderContent>
                    <MudTh Style="color:white;background-color:#dc3545">Dobavljač</MudTh>
                    <MudTh Style="color:white;background-color:#dc3545">Kategorije</MudTh>
                    <MudTh Style="color:white;background-color:#dc3545">Sifra AA</MudTh>
                    <MudTh Style="color:white;background-color:#dc3545">Vrsta AA</MudTh>
                    <MudTh Style="color:white;background-color:#dc3545">Period</MudTh>
                    <MudTh Style="color:white;background-color:#dc3545">Iznos refundacije PDV 10</MudTh>
                    <MudTh Style="color:white;background-color:#dc3545">Iznos refundacije PDV 20</MudTh>
                    <MudTh Style="color:white;background-color:#dc3545">Iznos realizovano PDV 10</MudTh>
                    <MudTh Style="color:white;background-color:#dc3545">Iznos realizovano PDV 20</MudTh>
                    <MudTh Style="color:white;background-color:#dc3545">Datum realizovano</MudTh>
                    <MudTh Style="color:white;background-color:#dc3545">Status</MudTh>
                    <MudTh Style="color:white;background-color:#dc3545">Tip obrade</MudTh>
                    <MudTh Style="color:white;background-color:#dc3545;text-align:center">I</MudTh>
                    <MudTh Style="color:white;background-color:#dc3545;text-align:center">NP</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Dobavljač">
                        @context.Dobavljac
                    </MudTd>
                    <MudTd DataLabel="Kategorije">
                        @context.Kategorija
                    </MudTd>
                    <MudTd DataLabel="Sifra AA">
                        @context.Sifra_AA
                    </MudTd>
                    <MudTd DataLabel="Vrsta AA">
                        @context.Vrsta_AA
                    </MudTd>
                    <MudTd DataLabel="Period">
                        @context.Period
                    </MudTd>
                    <MudTd DataLabel="Iznos refundacije PDV 10">
                        @context.Iznos_refundacije_stopa_1.Value.ToString("N")
                    </MudTd>
                    <MudTd DataLabel="Iznos refundacije PDV 20">
                        @context.Iznos_refundacije_stopa_2.Value.ToString("N")
                    </MudTd>
                    <MudTd DataLabel="Iznos realizovano PDV 10">
                        @context.Iznos_realizovano_stopa_1.Value.ToString("N")
                    </MudTd>
                    <MudTd DataLabel="Iznos realizovano PDV 20">
                        @context.Iznos_realizovano_stopa_2.Value.ToString("N")
                    </MudTd>
                    <MudTd DataLabel="Datum realizovano">
                        @context.Datum_realizovano
                    </MudTd>
                    <MudTd DataLabel="Status">
                        @context.status_stavke_obracuna
                    </MudTd>
                    <MudTd DataLabel="Tip obrade">
                        @context.obrada
                    </MudTd>
                    <MudTd Style="text-align:center" DataLabel="I">
                        <MudIcon Icon="@(context.I==true?@Icons.Filled.CheckCircleOutline:@Icons.Filled.Block)" Size="Size.Small" Color="@(context.I==true?Color.Success:Color.Error)"></MudIcon>
                    </MudTd>
                    <MudTd Style="text-align:center" DataLabel="NP">
                        <MudIcon Icon="@(context.NP==true?@Icons.Filled.CheckCircleOutline:@Icons.Filled.Block)" Size="Size.Small" Color="@(context.NP==true?Color.Success:Color.Error)"></MudIcon>
                    </MudTd>
                </RowTemplate>
                <PagerContent>
                    <MudTablePager HorizontalAlignment="HorizontalAlignment.Center" />
                </PagerContent>
            </MudTable>
        </MudItem>
        <MudItem lg="2" hidden="@Hide">
            <MudCard>
                <MudCardHeader>
                    <MudItem Class="d-flex flex-1">
                        <MudText Typo="Typo.h5">Filter</MudText>
                    </MudItem>
                    <MudItem Class="d-flex" Style="align-items:flex-end">
                        <MudTooltip Text="Resetuj Filter">
                            <MudIconButton Class="ml-auto" OnClick="(async()=>await ResetFilter())" Icon="@Icons.Filled.RestartAlt" Color="Color.Warning"></MudIconButton>
                        </MudTooltip>
                    </MudItem>
                </MudCardHeader>
                <MudCardContent>
                    <MudGrid>
                        <MudItem xs="12">
                            <MudSelect T="string" Label="Dobavljac" @bind-Value="filterModel.partnerName" For="(()=>filterModel.partnerName)" Variant="Variant.Filled" AnchorOrigin="Origin.BottomCenter">
                                @foreach (var partner in partnerName)
                                {
                                    <MudSelectItem Value="partner" />
                                }
                            </MudSelect>
                        </MudItem>
                    </MudGrid>
                    <MudGrid>
                        <MudItem xs="12">
                            <MudSelect T="string" Label="Kategorija" @bind-Value="filterModel.categoryName" For="(()=>filterModel.categoryName)" Variant="Variant.Filled" AnchorOrigin="Origin.BottomCenter">
                                @foreach (var category in category)
                                {
                                    <MudSelectItem Value="category" />
                                }
                            </MudSelect>
                        </MudItem>
                    </MudGrid>
                    <MudGrid>
                        <MudItem xs="12">
                            <MudSelect T="int?" Label="Sifra AA" @bind-Value="filterModel.codeAa" For="(()=>filterModel.codeAa)" Variant="Variant.Filled" AnchorOrigin="Origin.BottomCenter">
                                @foreach (var code in codeAA)
                                {
                                    <MudSelectItem Value="code" />
                                }
                            </MudSelect>
                        </MudItem>
                    </MudGrid>
                    <MudGrid>
                        <MudItem xs="12">
                            <MudSelect T="DateTime?" Label="Period od AA" @bind-Value="filterModel.periodOf" For="(()=>filterModel.periodOf)" Variant="Variant.Filled" AnchorOrigin="Origin.BottomCenter">
                                @foreach (var periodOf in periodOfAA)
                                {
                                    <MudSelectItem Value="periodOf" />
                                }
                            </MudSelect>
                        </MudItem>
                    </MudGrid>
                    <MudGrid>
                        <MudItem xs="12">
                            <MudSelect T="DateTime?" Label="Period do AA" @bind-Value="filterModel.periodTo" For="(()=>filterModel.periodTo)" Variant="Variant.Filled" AnchorOrigin="Origin.BottomCenter">
                                @foreach (var periodTo in periodToAA)
                                {
                                    <MudSelectItem Value="periodTo" />
                                }
                            </MudSelect>
                        </MudItem>
                    </MudGrid>
                    <MudGrid>
                        <MudItem xs="12">
                            <MudSelect T="short?" Label="Status" @bind-Value="filterModel.Status" For="(()=>filterModel.Status)" Variant="Variant.Filled" AnchorOrigin="Origin.BottomCenter">
                                @foreach (var status in Status)
                                {
                                    <MudSelectItem Value="status" />
                                }
                            </MudSelect>
                        </MudItem>
                    </MudGrid>
                    @*<MudGrid>
                        <MudItem xs="6">
                            <MudCheckBox @bind-Checked="filterModel.PDV10" For="(()=>filterModel.PDV10)" Label="PDV 10%"></MudCheckBox>
                        </MudItem>
                        <MudItem xs="6">
                            <MudCheckBox @bind-Checked="filterModel.PDV20" For="(()=>filterModel.PDV20)" Label="PDV 20%"></MudCheckBox>
                        </MudItem>
                    </MudGrid>*@
                </MudCardContent>
                <MudCardActions>
                    <MudButton Variant="Variant.Filled" ButtonType="ButtonType.Submit" OnClick="(async ()=> await ApplyFilter(filterModel))" Color="Color.Info" Size="Size.Small">Primeni filter</MudButton>
                    <MudButton Variant="Variant.Filled" Class="ml-auto" ButtonType="ButtonType.Submit" OnClick="(async ()=> await CloseFilter())" StartIcon="@Icons.Filled.Close" Color="Color.Error" Size="Size.Small">Zatvori</MudButton>
                </MudCardActions>
            </MudCard>
        </MudItem>
    </MudGrid>
</MudContainer>

